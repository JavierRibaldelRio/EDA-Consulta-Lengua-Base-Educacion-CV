{
  "hash": "bac5c2f04b117f2d8a03f2c3270547a8",
  "result": {
    "engine": "knitr",
    "markdown": "## Section\nThis is a simple placeholder for the manuscript's main document [@knuth84].\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.4     v readr     2.1.5\nv forcats   1.0.0     v stringr   1.5.1\nv ggplot2   3.5.2     v tibble    3.2.1\nv lubridate 1.9.4     v tidyr     1.3.1\nv purrr     1.0.4     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx purrr::%||%()   masks base::%||%()\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n# Reads csv and transforms percentages between 0 and 1\nresults <- read_csv(\"Resultados-Consulta_Base.csv\", locale = locale(decimal_mark = \",\"), show_col_types = FALSE) |> \n    mutate(pval = pval/100, pcas = pcas/100)\n\n\n# In regions where there are two names keeps the Spanish name\nresults$comarca <- str_trim(str_remove_all(results$comarca, pattern = \".*?/\"))\n\n# Define the curso as a factor\nresults$curso <- factor(results$curso, levels = c(\"2INF\", \"3INF\", \"4INF\", \"5INF\",\n                                                  \"1PRI\", \"2PRI\", \"3PRI\", \"4PRI\", \"5PRI\", \"6PRI\",\n                                                  \"1ESO\", \"2ESO\", \"3ESO\"), ordered = TRUE)\n\n\n\n\n# Get the data of the different centers of\n\ncentros <- read_csv(\"Centros-Comunidad-Valenciana.csv\",col_types = cols(\n    Codigo = col_character(),\n    Denominacion_Especifica = col_character(),\n    Denominacion = col_character(),\n    Regimen = col_character(),\n    Tipo_Via = col_character(),\n    Direccion = col_character(),\n    Num = col_character(),\n    Codigo_postal = col_character(),  \n    Localidad = col_character(),\n    Provincia = col_character(),\n    Telefono = col_character(),       \n    long = col_character(),\n    lat = col_number(),\n    Titularidad = col_character(),\n    CIF = col_character()\n  )\n) |> \n  rename(\n    codigo = Codigo,\n    denominacion_especifica = Denominacion_Especifica,\n    denominacion = Denominacion,\n    regimen = Regimen,\n    tipo_via = Tipo_Via,\n    direccion = Direccion,\n    num = Num,\n    codigo_postal = Codigo_postal,\n    localidad = Localidad,\n    provincia = Provincia,\n    telefono = Telefono,\n    longitud = long,\n    latitud = lat,\n    titularidad = Titularidad,\n    cif = CIF\n  )\n\n# Define una variable en función de si eel centro es público o privaod\ncentros <- centros |>\n    mutate(es_publico = if_else(\"Púb.\" == regimen, \"Público\", \"Concertado\"))\n\n# Pueblos con más habitantes\npueblos_mas_habitantes <- c(\"VALÈNCIA\", \"ALACANT\", \"ELX\", \"CASTELLÓ DE LA PLANA\", \"TORREVIEJA\", \"TORRENT\", \"ORIHUELA\", \"GANDIA\", \"PATERNA\", \"BENIDORM\",\"SAGUNT\",\"SANT VICENT DEL RASPEIG\",\"ALCOI\",\"ELDA\",\"VILA-REAL\",\"PAIPORTA\",\"PICANYA\",\"ONTINYENT\")\n```\n:::\n\n\n\nffs\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Gets the mean of Valencian\nmedia = mean(results$pval) \n\nresults |>\n    group_by(provincia) |>\n    summarise(val = mean(pval), cas = mean(pcas)) |>\n    \n    pivot_longer(!provincia, names_to = \"lengua\", values_to = \"porcentaje\")  |>\n    ggplot(aes(\n        x = provincia,\n        y = porcentaje,\n        fill = lengua,\n        label = str_c(ceiling(porcentaje * 10000) / 100, \"%\")\n    )) +\n    geom_col() +\n    geom_text(size = 5, position = position_stack(vjust = 0.5)) +    # Etiquetas centradas\n    scale_y_continuous(labels = scales::percent) +\n    scale_fill_manual(\n        # Leyenda\n        name = \"Lengua\",\n        labels = c(\"cas\" = \"Castellano\", \"val\" = \"Valenciano\"),\n        values = c(\"cas\" = \"#C41E3A\", \"val\" = \"orange\")\n    ) +\n    geom_hline(aes(yintercept = media), size = 2) +\n    annotate(\n        geom = \"label\",\n        x = \"Castelló\",\n        y = 0.58,\n        label = str_c(\"Porcentaje Valenciano: \", ceiling(media * 10000) /100, \"%\")\n    ) +\n    labs(\n        title = \"Resultado Consulta Lingüística Base por Provincia\",\n        subtitle = \"Comunidad Valenciana | Marzo 2025\",\n        x = \"Provincia\",\n        y = \"Porcentaje\",\n        caption = \"Fuente: gva.es\"\n    ) +\n    theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\ni Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-2-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nresults |>\n    group_by(provincia, comarca) |>\n    summarise(\n        val = mean(pval),\n        cas = mean(pcas) ) |>\n      mutate(comarca = fct_reorder(comarca, val)) |> \n    pivot_longer(\n        cols = -c(provincia, comarca),\n        names_to = \"lengua\",\n        values_to = \"porcentaje\"\n    ) |>\n    \n    ggplot(aes(\n        x = comarca,\n        y = porcentaje,\n        fill = lengua,\n        label = str_c(ceiling(porcentaje * 100), \"%\")\n    )) +\n    geom_col() +\n    geom_text(size = 2.5, position = position_stack(vjust = 0.5)) +    # Etiquetas centradas\n    scale_y_continuous(labels = scales::percent) +\n    scale_fill_manual(\n        # Leyenda\n        \n        name = \"Lengua\",\n        labels = c(\"cas\" = \"Castellano\", \"val\" = \"Valenciano\"),\n        values = c(\"cas\" = \"#C41E3A\", \"val\" = \"orange\")\n    ) +\n    labs(\n        title = \"Resultado Consulta Lingüística Base por Provincia\",\n        subtitle = \"Comunidad Valednciana | Marzo 2025\",\n        x = \"Comarca\",\n        y = \"Porcentaje\",\n        caption = \"Fuente: gva.es\"\n    ) +\n    facet_wrap( ~ provincia, scales = \"free_x\", ncol = 1) +\n    theme_minimal() +\n    theme(\n        axis.text.x = element_text(\n            angle = 30,\n            vjust = 1,\n            hjust = 1\n        ),\n        axis.ticks.x = element_line(color = \"black\"),\n        axis.ticks.length.x = unit(0.1, \"cm\")\n    )\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'provincia'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-3-1.pdf){fig-pos='H'}\n:::\n:::\n\n\nDado que el valenciano ha sido la lengua más votada, las gráficas de distribución de datos que se presentan a continuación se elaborarán únicamente para el valenciano, ya que el porcentaje de castellano se obtiene como su complementario. asdfsdfasfasdffsafv----\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nresults  |>\n    ggplot(aes(x=provincia, y =pval, color = provincia)) +\n    geom_boxplot() +\n    geom_violin()+\n    # Escalas\n    scale_y_continuous(labels = scales::percent) +\n    theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-4-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nresults  |>\n    ggplot(aes(x=pval, color = provincia)) +\n    geom_density() +\n    # Escalas\n    scale_x_continuous(labels = scales::percent) +\n    theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-5-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nresults |>\n    filter(localidad %in% pueblos_mas_habitantes) |>\n      mutate(localidad = fct_rev(factor(localidad, levels = sort(unique(localidad)))))|> \n    ggplot(aes(x=pval, y= localidad, color=provincia)) +\n    geom_boxplot() +\n    stat_summary(fun = mean, geom = \"point\", shape = 3, size = 2) +\n    theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-6-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n## Agrupación por cursos\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nresults |>\n    ggplot(aes(x= pval, y=curso, color = etapa)) +\n    geom_boxplot() +\n    stat_summary(fun = mean, geom = \"point\", shape = 3, size = 2) +\n    theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-7-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nresults |>\n    group_by(etapa,curso) |>\n    summarise(\n        val = median(pval),\n    )  |>\n    ggplot(aes(x= curso, group=1, color=etapa)) +\n    geom_line(aes(y=val)) +\n    scale_y_continuous(limits = c(0,1)) +\n    theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n`summarise()` has grouped output by 'etapa'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-8-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# Centros y su régimen\n\ncentros_regimen <- centros |>\n    select(codigo, es_publico)\n\nresults |>\n    select(codigo, pval,pcas) |>\n    right_join(centros_regimen, join_by(codigo == codigo)) |>\n    group_by(es_publico) |>\n    summarise(val = mean(pval,na.rm = TRUE), cas = mean(pcas, na.rm=TRUE) ) |>\n    pivot_longer(!es_publico, names_to = \"lengua\", values_to = \"porcentaje\") |>\n    ggplot(aes(\n        x = es_publico,\n        y = porcentaje,\n        fill = lengua,\n        label = str_c(ceiling(porcentaje * 10000) / 100, \"%\")\n    )) +\n    geom_col() +\n    geom_text(size = 5, position = position_stack(vjust = 0.5)) +    # Etiquetas centradas\n    scale_y_continuous(labels = scales::percent) +\n    scale_fill_manual(\n        # Leyenda\n        name = \"Lengua\",\n        labels = c(\"cas\" = \"Castellano\", \"val\" = \"Valenciano\"),\n        values = c(\"cas\" = \"#C41E3A\", \"val\" = \"orange\")\n    ) +\n    labs(\n        title = \"Resultado Consulta Lingüística Base por Régimen de Centro\",\n        subtitle = \"Comunidad Valenciana | Marzo 2025\",\n        x = \"Régimen\",\n        y = \"Porcentaje\",\n        caption = \"Fuente: gva.es\"\n    ) +\n    theme_minimal()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-9-1.pdf){fig-pos='H'}\n:::\n:::\n\n",
    "supporting": [
      "index_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}